# 🐛 驗證流程調試指南

## 📍 重要提醒

### 不同環境的行為

| 環境 | 驗證區塊顯示 | 行為 |
|------|-------------|------|
| 電腦瀏覽器 (localhost) | ❌ 隱藏 | 開發模式，自動驗證 |
| 手機瀏覽器 (ngrok) | ❌ 隱藏 | 開發模式，自動驗證 |
| **World App (ngrok)** | ✅ **顯示** | **需要驗證** |

⚠️ **關鍵：驗證流程只在 World App 中才會顯示！**

---

## 📱 正確的測試方法

### ❌ 錯誤方式
```
在電腦瀏覽器訪問 http://localhost:8000
→ 這是開發模式，不會顯示驗證選項
```

```
在手機瀏覽器訪問 https://9aea826ff3a9.ngrok-free.app
→ 這還是開發模式，不會顯示驗證選項
```

### ✅ 正確方式

**必須在 World App 中打開！**

1. **在手機瀏覽器輸入：**
   ```
   worldapp://mini-app?app_id=app_8759766ce92173ee6e1ce6568a9bc9e6
   ```

2. **或在 World App 中：**
   - 進入 Mini Apps 標籤
   - 找到「極簡停車」
   - 點擊打開

---

## 🔍 檢查控制台訊息

### 在 World App 中應該看到：

打開 World App 的開發者工具（如果可用），或查看日誌：

```
🌍 在 World App 中運行
🚀 自動觸發 World ID 驗證...
顯示驗證選項...
👀 驗證區塊元素: [object HTMLDivElement]
👀 驗證按鈕: [object HTMLButtonElement]
👀 跳過按鈕: [object HTMLButtonElement]
✅ 驗證選項已顯示
```

### 在普通瀏覽器中會看到：

```
🌐 在普通瀏覽器中運行（開發模式）
啟用降級模式
```

---

## 🧪 測試清單

### 步驟 1：確認 ngrok 運行中

在終端確認 ngrok 還在運行：
```bash
# 應該看到類似：
Forwarding  https://9aea826ff3a9.ngrok-free.app -> http://localhost:8000
```

### 步驟 2：確認 Developer Portal 設置

1. 訪問 https://developer.worldcoin.org/
2. 確認 App URL 設置為：`https://9aea826ff3a9.ngrok-free.app`

### 步驟 3：在手機上測試

1. **清除 World App 緩存**
   - 完全關閉 World App
   - 重新打開

2. **使用深層連結**
   - 在手機瀏覽器輸入深層連結
   - 跳轉到 World App

3. **觀察行為**
   - 等待 1-2 秒
   - 應該看到兩個按鈕出現
   - 驗證按鈕應該有脈衝動畫

---

## 🎯 預期行為

### 打開 Mini App 時：

```
秒數 0: 載入遊戲畫面
秒數 1: 自動顯示驗證選項
       ┌────────────────────────────┐
       │  🌍 使用 World ID 驗證     │ ← 有脈衝動畫
       ├────────────────────────────┤
       │  ⏳ 跳過驗證（測試模式）   │
       └────────────────────────────┘
       [ 開始遊戲 ] ← 灰色（禁用）
```

### 點擊「使用 World ID 驗證」：

```
→ World App 顯示驗證流程
→ 完成 Orb 驗證
→ 顯示：✅ 真人驗證成功 (綠色)
→ 按鈕：✅ 開始遊戲（已驗證）
```

### 點擊「跳過驗證」：

```
→ 顯示：⏳ 測試模式 (黃色)
→ 按鈕：⏳ 開始遊戲（測試）
```

---

## 🐛 常見問題排查

### Q1: 在 World App 中還是沒有顯示驗證選項

**可能原因：**
- World App 沒有載入最新版本

**解決方法：**
1. 完全關閉 World App（從後台清除）
2. 確認 GitHub Pages 已部署最新代碼
3. 或者在 Developer Portal 中刷新 URL
4. 重新打開 World App

### Q2: 立即顯示「真人驗證成功」

**原因：**
- 這是快取的狀態
- 或者之前已經驗證過

**解決方法：**
1. 完全關閉並重啟 World App
2. 清除 App 數據（如果可以）
3. 等待幾秒讓 JavaScript 重新執行

### Q3: 按鈕沒有脈衝動畫

**原因：**
- CSS 動畫可能沒有載入

**解決方法：**
- 檢查 style.css 中是否有 `@keyframes pulse`
- 強制刷新頁面

---

## 🔬 進階調試

### 在 World App 中啟用開發者工具

如果 World App 支持，可以：
1. 在設置中啟用開發者模式
2. 查看控制台日誌
3. 檢查 JavaScript 錯誤

### 查看網路請求

1. 訪問 ngrok 管理介面：`http://localhost:4040`
2. 查看 World App 發送的請求
3. 確認載入了正確的文件

---

## 📝 測試報告模板

如果還是有問題，請提供以下資訊：

```
環境：
- 設備：[iPhone/Android]
- World App 版本：[版本號]
- 測試方式：[深層連結/從 App 內打開]

觀察到的行為：
- 打開後看到什麼？
- 有沒有顯示驗證按鈕？
- 控制台有什麼錯誤訊息？

期望的行為：
- 應該看到兩個按鈕（驗證 + 跳過）
- 驗證按鈕有脈衝動畫
```

---

## ✅ 成功標準

當你看到以下情況時，表示成功：

- ✅ 在 World App 中打開遊戲
- ✅ 1 秒後自動顯示驗證選項
- ✅ 看到「🌍 使用 World ID 驗證」按鈕（有動畫）
- ✅ 看到「⏳ 跳過驗證（測試模式）」按鈕
- ✅ 「開始遊戲」按鈕是灰色的
- ✅ 點擊驗證或跳過後，按鈕變為可用

---

需要更多幫助？告訴我你看到了什麼！📱

